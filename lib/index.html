<!DOCTYPE html>

<html>
<head>
  <title>gilk</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="/gilk/bootstrap/css/bootstrap.min.css">
  <!-- Code highlighting -->
  <link rel="stylesheet" href="/gilk/prism/prism-hopscotch.css">
</head>
<body>
    <div class="container">
        <nav class="navbar navbar-inverse navbar-static-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a href="/gilk/">
                    <span class="navbar-brand">gilk</span>
                    </a>
                </div>
            </div>
        </nav>
    </div>
    <div class="container">
      <div id="header">
      </div>
      <div class="sections">
          <p>Configuration for the Markdown renderer</p>
          <div><pre class="language-javascript" data-start="19"><code class="language-javascript">markdown.setOptions({
    renderer: new markdown.Renderer(),
    gfm: true,
    tables: true,
    breaks: true,
    pedantic: false,
    sanitize: false,
    smartLists: true,
    smartypants: false
});

module.exports = function gilk(config) {</code></pre></div>
          <p>Default configuration</p>
          <div><pre class="language-javascript" data-start="34"><code class="language-javascript">config = assign({
        base: '.',
        dest: '.',</code></pre></div>
          <p>Optional custom Mustache page template</p>
          <div><pre class="language-javascript" data-start="38"><code class="language-javascript">pageTmpl: null,
baseurl: '',
title: 'Home',</code></pre></div>
          <p>Optional js script</p>
          <div><pre class="language-javascript" data-start="42"><code class="language-javascript">js: null,</code></pre></div>
          <p>Optional css script</p>
          <div><pre class="language-javascript" data-start="44"><code class="language-javascript">css: null,
'exclude-source': null
        },</code></pre></div>
          <p>Override default properties and add custom properties</p>
          <div><pre class="language-javascript" data-start="48"><code class="language-javascript">config);</code></pre></div>
          <p>Retrieve page template content</p>
          <div><pre class="language-javascript" data-start="51"><code class="language-javascript">var pageTmpl = fs.readFileSync(config.pageTmpl || path.join(templates, 'page.tmpl')).toString(),
    sources = [],
    tasks = [];
if (!config.pageTmpl) {</code></pre></div>
          <p>stream static resources associated with the  default template</p>
          <div><pre class="language-javascript" data-start="56"><code class="language-javascript">tasks.push(new Promise(function(resolve) {
    vinylFs.src(path.join(publicSrc, '**/*')).pipe(through(function(resource) {
        stream.queue(resource);
    }, resolve));
}));
    }</code></pre></div>
          <p>The documentation transform stream</p>
          <div><pre class="language-javascript" data-start="64"><code class="language-javascript">var stream = through(function(file) {
    var docFile = renderDocFile(pageTmpl, file, config);
    var sourcePath = path.relative(file.base, docFile.path);
    sources.push({
        href: sourcePath,
        name: path.join(path.dirname(sourcePath), path.basename(sourcePath, '.html')).split(path.sep).join('/')
    });</code></pre></div>
          <p>stream source js file</p>
          <div><pre class="language-javascript" data-start="72"><code class="language-javascript">if (!config['exclude-source']) {
    this.queue(file);
}</code></pre></div>
          <p>stream doc html</p>
          <div><pre class="language-javascript" data-start="76"><code class="language-javascript">this.queue(docFile);
    }, function() {</code></pre></div>
          <p>stream a JSON representation of the TOC</p>
          <div><pre class="language-javascript" data-start="79"><code class="language-javascript">stream.queue(new File({
    path: 'toc.json',
    contents: new Buffer(JSON.stringify(sources))
}));
if (config.index) {</code></pre></div>
          <p>Render the index page</p>
          <div><pre class="language-javascript" data-start="85"><code class="language-javascript">tasks.push(
    renderIndex(pageTmpl, sources, config).then(function(contents) {
        stream.queue(new File({
            path: 'index.html',
            contents: new Buffer(contents)
        }));
    })
);
        }
        Promise.all(tasks).then(function() {
stream.queue(null);
        }, function(err) {
console.error(err);
        });
    });

    return stream;
};

function renderDocFile(pageTmpl, file, config) {
    var ext = path.extname(file.path),
        filename = path.basename(file.path, ext);
    var comments = dox.parseComments(file.contents.toString());
    var doc = Mustache.render(pageTmpl,
        assign({
srcfile: path.relative(config.base, file.path),
comments: comments</code></pre></div>
          <p>All <code>config</code> properties are available in the page template</p>
          <div><pre class="language-javascript" data-start="113"><code class="language-javascript">}, config));
    return assign(file.clone(), {
contents: new Buffer(doc),
path: file.path.replace(/\.js$/, '.html')
    });
}

function renderIndex(pageTmpl, sources, config) {
    return new Promise(function (resolve, reject) {
var ext = path.extname(config.index),
    name = path.basename(config.index, ext);

fs.readFile(config.index, function (err, buf) {
    var comments = [{
        description: {
            full: markdown(buf.toString())
        }
    }];
    resolve(Mustache.render(pageTmpl,
        assign({
            isIndex: true,
            comments: comments,
            toc: {
                sources: sources
            }
        },</code></pre></div>
          <p>All <code>config</code> properties are available in the page template</p>
          <div><pre class="language-javascript" data-start="140"><code class="language-javascript">config)
            ));
        });
    });
}</code></pre></div>
      </div>
      <hr>
  </div>
  <script type="text/javascript" src="/gilk/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/gilk/bootstrap/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/gilk/prism/prism.js"></script>
</body>
</html>
